{% extends "admin/base_site.html" %}
{% block bootstrap %}
<script>
    $('.collapse').collapse()
</script>
{% endblock %}
{%block content%}
{% block body %}
{% load ngsdbview_extras %}
{% load humanize %}

{%  if experiments  %}
<FORM action="." method="post">
{% csrf_token %}
    <TABLE>
        <TR>
            <TD>

                {{ form.as_table }}
            </TD>
            <TD>
                <input type="submit"  name="levelTwo" value="Filter" />
                </form>
            </TD>
        </TR>
    </TABLE>
</FORM>

    {% for exp in experiments %}
        <!-- experiment table -->
            <div id="masterPanel">
                <TABLE><TR>
                <TH> {{ forloop.counter }}.  <a href="/ngsdbview/detailexperiment/{{ exp.id }}/" target="_blank">{{ exp.name }}</a></TH>
                <TD>Analysis Version: {{ exp.version }}</TD>
                <TD>Exp. type:  {{ exp.type }}</TD>
                <TD>Collaborator:  {{ exp.collaborator }}</TD>
                <TD>Ref. Genome:  {{ exp.refgenome }}</TD>
                <TD>
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse1_{{ forloop.counter }}"> Notes and Description </a>
                </TD>
                <TD>
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse2_{{ forloop.counter }}"> Samples/Libraries included </a>
                </TD>
                </TR></TABLE>
            </div>

        <!-- notes and description collapsible -->
            <div id="collapse1_{{ forloop.counter }}" class="panel-collapse collapse in" style="height: auto;">
                <TABLE>
                    <TR><TH>Description:</TH><TD>{{ exp.description }}</TD></TR>
                    <TR><TH> Notes:</TH><TD>{{ exp.notes }}</TD></TR>
                </TABLE>
            </div>

        <!-- Sample/Library details collapsible -->
            <div id="collapse2_{{ forloop.counter }}" class="panel-collapse collapse in" style="height: auto;">
                <TABLE>
                    <TR><TD>Included Samples:,</br>(sampleid, </br>lifecyclestage, </br>culture-method, </br>growthphase, </br>treatment, </br>librarycode)</TD>
                        {% for sample in exp.samples.all %}
                        <TD>
                            {{ sample.sampleid }};  </br>
                            {{ sample.lifestage }}; </br>
                            {{ sample.culture_method }}; </br>
                            {{ sample.growthphase }} </br>
                            {{ sample.treatment }} </br>
                            {% for lib in sample.library_set.all %}
                                {{ lib.library_code }}
                            {% endfor %}; </br>
                        </TD>
                        {% endfor %}
                    </TR>
                </TABLE>
                </div>


        <!-- experiment setup table -->
        <!--
            <TABLE>
                <TR><TH>Experimental Setup:</TH></TR>
                <TR>
                {% for exptsetup in exp.exptsetup_set.all %}
                <TD>
                <TABLE>
                    <TR><TD> Condition/Group : {{ exptsetup.groupname }} </TD></TR>
                    <TR><TD> Libraries :
                        {% for lib in  exptsetup.libraries.all %}
                        {{ lib }}
                        {% endfor %}
                    </TD></TR>
                    <TR><TD>notes : {{ exptsetup.notes }} </TD></TR>
                </TABLE>
                </TD>
                {% endfor %}

            </TR></TABLE>
        -->




    {% endfor %}
{% else %}
<FORM action="." method="post">
{% csrf_token %}
    <TABLE>
        <TR>
            <TD>

                {{ form.as_table }}
            </TD>
            <TD>
                <input type="submit"  name="levelOne" value="Submit" />
                </form>
            </TD>
        </TR>
    </TABLE>
</FORM>
{% endif %}
{% endblock %}
{% endblock %}
